#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';

use function Docopt\docopt;

$doc = <<<DOC

Generate diff


Usage:
    gendiff (-h|--help)
    gendiff (-v|version)
    gendiff [--format <fmt>] <firstFile> <secondFile>

Options:
    -h --help       Show this screen
    -v --version    Show version
    --format <fmt>  Report format [default: stylish]

DOC;

$args = Docopt::handle($doc, array('version'=>'1.0.0'));

try {
    $firstFileData = GenDiff\Src\Parsers\parseData($args['<firstFile>']);
    $secondFileData = GenDiff\Src\Parsers\parseData($args['<secondFile>']);
} catch (RuntimeException $e) {
    echo "Error parsing files: " . $e->getMessage() . PHP_EOL;
    exit(1);
}
$format = $args['--format'] ?? 'stylish';

if (!is_array($firstFileData) || !is_array($secondFileData)) {
    throw new RuntimeException("One of the parsed data is not an array.");
}
$result = Differ\Differ\genDiff($firstFileData, $secondFileData, $format);

print_r(GenDiff\Src\Formatters\getFormatters($result, $format));